{% extends 'base.html' %}
{% load static %}

{% block title %}E-Shop - Home{% endblock %}

{% block content %}

<!-- Hero Section -->
<section
  class="relative bg-gradient-to-r from-purple-700 to-blue-600 text-white rounded-xl overflow-hidden p-16 mb-16 shadow-lg"
>
  <div class="container mx-auto flex flex-col lg:flex-row items-center gap-8">
    <div class="lg:w-7/12">
      <h1 class="text-5xl font-extrabold mb-4 drop-shadow-lg">
        Welcome to E-Shop
      </h1>
      <p class="text-xl mb-2 opacity-90">
        Discover premium products at unbeatable prices!
      </p>
      <p class="mb-6">
        Shop our extensive catalog of high-quality products curated just for you.
      </p>
      <a
        href="{% url 'product_list' %}"
        class="inline-block bg-white text-purple-700 font-semibold px-8 py-3 rounded-full shadow-md hover:bg-gray-100 transition transform hover:-translate-y-1"
      >
        <i class="fas fa-shopping-bag mr-2"></i> Explore Collection
      </a>
    </div>
    <div class="lg:w-5/12 hidden lg:block">
      <img
        src="{% static 'images/shop.jpg' %}"
        alt="Welcome"
        class="rounded-xl shadow-lg w-full h-auto object-cover"
      />
    </div>
  </div>
</section>

<!-- Categories -->
<section class="container mx-auto mb-16">
  <div class="text-center mb-12">
    <h2 class="text-3xl font-bold mb-2">Shop by Category</h2>
    <p class="text-gray-600">Explore our wide range of product categories</p>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for category in categories %}
      <div class="bg-white rounded-xl shadow-md p-6 text-center">
        <h3 class="font-semibold text-xl mb-2">{{ category.name }}</h3>
        <p class="text-gray-600 mb-3">
          {{ category.description|truncatechars:100 }}
        </p>
        <a
          href="{% url 'product_list_by_category' category.slug %}"
          class="inline-block bg-purple-700 text-white py-2 px-6 rounded-full"
        >
          Browse
        </a>
      </div>
    {% empty %}
      <p class="col-span-full text-center text-gray-500">
        No categories available.
      </p>
    {% endfor %}
  </div>
</section>

<!-- Featured Products -->
<section class="container mx-auto mb-16">
  <div class="text-center mb-12">
    <h2 class="text-3xl font-bold mb-2">Featured Products</h2>
    <p class="text-gray-600">
      Check out our most popular items
    </p>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">

    {% for product in featured_products %}
    <div class="bg-white rounded-xl shadow-md overflow-hidden">

      <!-- Product Image -->
      <div class="h-52 w-full overflow-hidden">
        {% if product.images.exists %}
          {% with img=product.images.first %}
            <img
              src="{{ img.image.url }}"
              alt="{{ product.name }}"
              class="w-full h-full object-cover"
            />
          {% endwith %}
        {% else %}
          <div class="h-full flex items-center justify-center bg-gray-100">
            <i class="fas fa-image text-3xl text-gray-400"></i>
          </div>
        {% endif %}
      </div>

      <!-- Product Info -->
      <div class="p-4">
        <h5 class="font-semibold text-lg mb-1">
          {{ product.name }}
        </h5>

        <p class="text-gray-600 text-sm mb-2">
          {{ product.description|truncatechars:80 }}
        </p>

        <div class="flex justify-between items-center">
          <span class="font-bold text-lg">à§³{{ product.price }}</span>

          <!-- Rating FIXED -->
          <div class="text-yellow-400">
            {% for i in "12345" %}
              {% if forloop.counter <= product.average_rating %}
                <i class="fas fa-star"></i>
              {% else %}
                <i class="far fa-star"></i>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="p-4 flex flex-col gap-2">
        <a
          href="{% url 'product_detail' product.slug %}"
          class="text-center py-2 rounded-full border border-purple-700 text-purple-700 hover:bg-purple-700 hover:text-white transition"
        >
          View Details
        </a>

        <form action="{% url 'cart_add' product.id %}" method="post">
          {% csrf_token %}
          <button
            type="submit"
            class="bg-purple-700 text-white py-2 rounded-full w-full hover:bg-purple-800"
          >
            Add to Cart
          </button>
        </form>
      </div>

    </div>
    {% empty %}
      <p class="col-span-full text-center text-gray-500">
        No featured products available.
      </p>
    {% endfor %}

  </div>
</section>

{% endblock %}
